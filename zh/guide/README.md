## 为什么做这个 why do it 

    市场上并没有发现有一个针对有价证券行情的数据库,他需要同时满足以下的要求：

    1. 输入和输出【速度】瓶颈仅限于网络带宽;
       查询应保证绝大部分都在内存中进行, 除非特定指出,否则只会读取和处理内存中的数据; 
       写入应保证为硬盘顺序写入的速度, 根据限定内存大小自动存储非活跃数据至存储设备; 
       由于默认只有时间为索引, 因此建立索引的时间基本可以忽略不计, 并能快速定位;
       数据安全性保证应该是这样的: 
        收到写入指令首先写入顺序文件aof中,成功后再处理到数据库中, 当掉电等异常出现时, 首先加载磁盘文件再处理aof中的顺序指令, 以恢复掉电前数据库的状态, 数据库提供对外服务; 

    2. 输入和输出【格式】支持二进制数据流和字符串数据流; 
       二进制数据流包括结构化数据、压缩数据格式传输;
       字符串数据流包括JSON格式、数组格式、CSV格式的输入和输出, 对JSON格式还应该支持变量字段传输, 其他字段自动增补的功能;
       可以指定字段输出、指定时间段输出、指定数量输出;
       数据库的磁盘文件也可以设定格式为二进制和字符串文件格式，方便数据库数据分析、备份和迁移;

    3. 输入一个时间节点的价格,数据库可以自动完成不同时间尺度的数据聚合,而不需要操作者去控制;
       这里引入了数据层级的概念（详情请见后续章节）, 数据层级的引入,极大的减轻了数据采集者的工作量,同时提高了访问者的速度和便捷性；

    4. 输入和输出的【通讯协议】不仅支持TCP、还应该支持HTTP、WS协议;
       对于大型项目来说,在sisdb和前端中间应该还有一层server用于用户服务和数据调度, 那么支持TCP协议已经足够使用了;
       但是多数时候, 我们会直接使用 sisdb + clchart 来直接进行图表展示和策略分析, 此时为了敏捷开发, 我们就需要支持HTTP和WS协议, 这样客户端通过浏览器支持的协议就可以直接访问到sisdb的数据;

    6. 数据库还需要支持可插拔的算法库(V2.0);
       sisdb的存在就是为了证券智能化交易, 因此基础数据有了之后,就需要建设各类算法库, 用于提供投资交易;
       V2.0中会支持Pyhon和其他C语言友好的语言插件库;
       插件库的作用也基本等同于数据库中的存储过程;

    7. 集群节点支持(V2.0);
       V2.0中会支持集群功能,并对所有节点进行分层,这里每个节点并不会对数据进行分片, 而是保留了全部的数据, 扩容时对节点完整复制,执行初始化指令就加入到集群中了; 这样的话即便系统中99%的节点不可恢复的崩溃, 只要有一个节点, 其他节点即可恢复;
       这样设计的目的是因为证券策略的私密、高速、运算密集的特性决定的, 具有独立而灵活的特点;
       根节点可能只有最基本的数据, 而子节点可以复制上级节点的所有数据,     

    8. sisdb的限制
       仅仅针对有价证券的行情和交易数据进行存储，因此对于字符串数据保存不具备优势，也无意在此方向深入；
       强项在于价格数据处理和压缩方面，以字段和结构化字段集合为基础数据，

## sisdb 的设计规划

    2018年12月31日 -- 完成V1.0开发和使用，对接clchart实现前后端证券行情展示

    2019年 6月30日 -- 完成V2.0开发和使用，完善数据库性能和功能

    未来 -- 通过cs网络爬虫，建立全球有价证券的分布式数据网络，所有行情信息由社区力量贡献并分享;


## 创建实例

    1.下载安装

    git clone https://github.com/sisdb/redis.git
    cd redis
    make

到这里安装了redis的客户端，请用上述地址的客户端，否则不能输入json指令

    src/redis-cli -h 139.224.34.92 -p 15001 -a clxx@1110

    stsdb.list      
    --- 列出所有数据表

    stsdb.get sh600600.day {"search":{"min":20180629}}    
    --- 列出20180629的日线数据

    stsdb.get sh600600.day {"fields":"time,close","format":"array","search":{"min":20180105,"count":10}}
    --- 以数组格式列出20180105后共10条日线数据，只需要time和close字段

    stsdb.set SH123.now json {"time":1530498214,"close":100,"vol":1000}
    --- 传入一条新的行情，会同时更新相关联的其他表，某些关联表必须大于0的时候才会更新
    stsdb.get SH123.tick
    stsdb.get SH123.min
    stsdb.get SH123.min5
    stsdb.get SH123.day
    stsdb.get SH123.now
    --- 虽然只写入了一条数据，数据库已经更新了相关的其他数据




## 指令集

## 配置说明

## 插件和算法库

## 集群

    2. 数据层级
       表层级 ： 上级表的数据写入会引起下级表的数据变化；
       时间级 ： 细粒度的时间数据可以分发给粗粒度的时间数据;
       节点层级 ： 对于集群来说, 低等级的节点数据总是以高等级节点为标准的, 这样可以统一因各种原因造成的分片数据不统一的问题, 低级节点可主动请求数据, 高级节点仅在特定时候要求下级节点进行数据更新,  

    3. 输出查询可以匹配最近时间的数据;
       在策略研究中, 经常会要避免的问题就是未来数据引入, 因此sisdb的查询首先保证不能获取未来数据;
       支持模糊查询、对不存在的日期和时间, 遵循按左右、右左的原则返回数据, 保证只能查询已经发生过的数据;


